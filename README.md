# What is **BEAST_pype**?  
# An automated pipeline for high throughput phylodynamic analyses using BEAST 2.

BEAST_pype is a pipeline for [BEAST-2](https://www.beast2.org/) with aim of 
automating many of the steps involved in phylodynamics using BEAST-2. The [workflows](Overview-of-running-workflows.md)
expedite phylodynamic analyses using BEAST-2 via a series of Jupyter Notebooks and python code. 

BEAST_pype was conceived with the aim to speed up and automate the use of BEAST-2 analyses for routine public health use at the Public Health Agency of Canada.  
Activities include running routine analyses on continuously circulating viruses, such as SARS-CoV-2. Also, for accelerating research or outbreak investigations that require several experimental runs for optimization and more rapid results generation.  

Features of BEAST_pype include:  
* Command-line launchable, and Yaml file parametrized pipeline.
* Improved XML generation and re-use. e.g. using user-provided BEAST-2 xmls as a template for generating a new BEAST-2 xml
   from new sequences with the associated metadata.
* Launching several parallelized runs and a GUI for selecting converged MCMC chains.
* Automated generation of reports analysing BEAST 2 runs (diagnostic and result plots and statistics).
* Ability to create and include initial trees for faster runs.
* Incorporating downsampling techniques.

# What does it do?
In general, a beast_pype workflow does the following:  
   1. **Alter a pre-existing XML** _(e.g. replaces the sequence and date metadata in a template xml generating a new copy), without opening in BEAUTi, to configure your runs.  OR if you have a XML that is ready-to-go, then you'd start in step 2._
   2. **This modified XML is run in BEAST-2 several times in parallel** _(either on a cluster or on a local computer)._
   3. **Generates a jupyter notebook (Diagnostic)** _that pulls in the results of all the different results (similar to Tracer). In the notebook 
the user selects converged chains and a burnin_ **to create a merged logfile and tree**.  
   4. _Finally, the Diagnostic notebook_ **produces a Report notebook** _on the merged log files. Includes plots and tables of estimated 
parameters and results. A html version of the notebook is also generated_.

Flow:
- A "parameter" Yaml setups the BEAST_pype workflow._(The user parameterises the beast_pype workflow in the Yaml file, e.g. which template xml to use, fasta to use, 
metadata to use, etc.)_
- The user then launches the Yaml and Workflow Notebook at the command line.  
- The Workflow Notebook acts like 'the controller' of the pipeline, and thus runs the various Module Notebooks.
  
![General_Workflow_Running.png](image_files/General_Workflow_Running.png)

Note, there are various options on how to run BEAST-2 (e.g. change number of chains to run), and whether to include an initial starting 
tree (e.g. run IQTree first) or to downsample the dataset before launching BEAST, etc. These are declared in the Yaml file before launching.  

To leverage previous work and to standardize runs, there are several template parameter Yamls and BEAST 2 xmls that can used (see 'Guides on specific Workflows' in [Table of Contents](#table-of-contents).  


# Table of Contents

* [Installation Instructions](Installation-Instructions.md)
* [Overview of running workflows](Overview-of-running-workflows.md)
* Guides on specific workflows:
  - [Generic Workflow](Generic-Workflow.md): a workflow intended for ANY BEAST-2 XML (either customizable [template-xml](Glossary-of-Terms.md#template-xml) or [ready-to-go-xml](Glossary-of-Terms.md#ready-to-go-xml)).
  - [BDSKY Serial Workflow](BDSKY-Serial-Workflow.md) a workflow intended for BDSKY-serial BEAST 2 XMLs (either customizable [template-xml](Glossary-of-Terms.md#template-xml) or [ready-to-go-xml](Glossary-of-Terms.md#ready-to-go-xml)).
  - The 'Comparative' Workflows, for additional separation and comparison of datasets (e.g. split-up and compare by location or strain):
    - [Generic Comparative Workflow](Generic-Comparative-Workflow.md).
    - [BDSKY Serial Comparative Workflow](BDSKY-Serial-Comparative-Workflow.md).
* [Troubleshooting](Troubleshooting.md)
* Python API (to be  generated by sphinx)
* [Notebook modules API](Notebook-modules-API.md) (under construction)


# 
Authors, Legal, software bibliography (softwares used), how to cite etc.

This site is under construction - please submit suggestions to the authors or open up issues in the git. Feedback is very welcome. 

